# 이커머스 요구사항 정의

사용자 시나리오를 기반으로 이벤트 스토밍, 바운디드 컨텍스트 식별, 유비쿼터스 언어 정의, 기능 요구사항을 정리한 문서

## 목차

- [1. 이벤트 스토밍](#1-이벤트-스토밍)
- [2. 바운디드 컨텍스트](#2-바운디드-컨텍스트)
- [3. 유비쿼터스 언어 정의 (Glossary)](#3-유비쿼터스-언어-정의-glossary)
- [4. 비즈니스 규칙 및 정책](#4-비즈니스-규칙-및-정책)
- [5. 기능 요구사항](#5-기능-요구사항)
  - [브랜드](#브랜드)
  - [상품](#상품)
  - [좋아요](#좋아요)
  - [주문](#주문)

---

## 1. 이벤트 스토밍

시스템에서 상태를 변경하는 사건을 시간 순서로 나열한다.

```
상품이 좋아요됨 / 좋아요 취소됨
브랜드가 등록됨 → 브랜드가 수정됨 → 브랜드가 삭제됨 → 브랜드 상품이 삭제됨
상품이 등록됨 → 상품이 수정됨 → 상품이 삭제됨
주문됨 → 주문 취소됨
```

---

## 2. 바운디드 컨텍스트

| 컨텍스트 | 이벤트 |
|----------|--------|
| 브랜드 | 브랜드가 등록됨, 수정됨, 삭제됨 |
| 상품 | 상품이 등록됨, 수정됨, 삭제됨, 브랜드 상품이 삭제됨 |
| 좋아요 | 상품이 좋아요됨, 좋아요 취소됨 |
| 주문 | 주문됨, 주문 취소됨 |

---

## 3. 유비쿼터스 언어 정의 (Glossary)

[glossary.md](glossary.md) 참조

---

## 4. 비즈니스 규칙 및 정책

도메인별로 지켜야 하는 비즈니스 규칙과 공통 운영 정책을 정의한다.
각 규칙은 고유 ID를 가지며, 기능 요구사항에서 해당 ID로 참조한다.

> **공통 정책**은 모든 기능에 암묵적으로 적용되므로 개별 기능에서 별도로 참조하지 않는다.
> **도메인 규칙**은 해당 규칙이 적용되는 기능에서 `적용 규칙`으로 명시한다.

### 공통 정책

#### 인증 정책

- 유저 로그인이 필요한 기능은 아래 헤더를 통해 유저를 식별하며, users 테이블에서 검증한다.
  - `X-Loopers-LoginId` : 로그인 ID
  - `X-Loopers-LoginPw` : 비밀번호
- 유저는 타 유저의 정보에 직접 접근할 수 없다.
- 관리자 기능은 아래 헤더를 통해 관리자를 식별한다.
  - `X-Loopers-Ldap` : loopers.admin
- 인증에 실패하면 요청은 거부된다.

#### 페이징 정책

- 목록 조회 시 한 페이지당 20개씩 조회한다.

### 브랜드

| ID | 규칙 |
|----|------|
| BRD-01 | 브랜드 삭제 시 해당 브랜드에 속한 상품도 함께 삭제된다. |

### 상품

| ID | 규칙 |
|----|------|
| PRD-01 | 상품 등록 시 해당 상품이 속할 브랜드가 사전에 등록되어 있어야 한다. |
| PRD-02 | 상품 삭제 시 해당 상품의 좋아요도 함께 삭제된다. |

### 좋아요

| ID | 규칙 |
|----|------|
| LIK-01 | 동일 상품에 중복 좋아요할 수 없다. |
| LIK-02 | 본인의 좋아요만 취소할 수 있다. |

### 주문

| ID | 규칙 |
|----|------|
| ORD-01 | 주문 시 하나라도 재고가 부족한 상품이 있으면 주문 전체가 실패한다. (All or Nothing) |
| ORD-02 | 주문 생성 시 주문 시점의 상품 정보(상품명, 단가)를 스냅샷으로 저장한다. |
| ORD-03 | 주문 취소 시 차감된 재고가 복원된다. |
| ORD-04 | 이미 취소된 주문은 재취소할 수 없다. |

---

## 5. 기능 요구사항

### 브랜드

#### 브랜드 목록 조회

**사용자 유형**: 일반 사용자

**기능 정의**

- 브랜드 목록을 조회한다.
- 최신 등록순으로 브랜드 목록을 정렬한다.

**기본 흐름**

1. 브랜드 목록 조회를 요청한다.
2. 브랜드 목록을 조회한다.
3. 브랜드 목록을 반환한다.

**대안 흐름**

- 최신순으로 보기를 원하면 최신순으로 정렬해 보여준다.

#### 브랜드 상세 조회

**사용자 유형**: 일반 사용자

**기능 정의**

- 특정 브랜드의 상세 정보를 조회한다.

**기본 흐름**

1. 브랜드 ID로 상세 조회를 요청한다.
2. 해당 브랜드 정보를 조회한다.
3. 브랜드 상세 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 브랜드 ID인 경우 조회에 실패한다.

#### 브랜드 등록

**사용자 유형**: 관리자

**기능 정의**

- 브랜드 정보를 등록한다.

**기본 흐름**

1. 브랜드 정보를 등록한다.
2. 등록된 브랜드 정보를 반환한다.

#### 브랜드 목록 조회

**사용자 유형**: 관리자

**기능 정의**

- 등록된 브랜드 목록을 조회한다.

**기본 흐름**

1. 브랜드 목록을 조회한다.
2. 브랜드 목록을 반환한다.

#### 브랜드 상세 조회

**사용자 유형**: 관리자

**기능 정의**

- 특정 브랜드의 상세 정보를 조회한다.

**기본 흐름**

1. 브랜드 ID로 상세 정보를 조회한다.
2. 브랜드 상세 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 브랜드 ID인 경우 조회에 실패한다.

#### 브랜드 수정

**사용자 유형**: 관리자

**기능 정의**

- 브랜드 정보를 수정한다.

**기본 흐름**

1. 브랜드 존재 여부를 확인한다.
2. 브랜드 정보를 수정한다.
3. 수정된 브랜드 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 브랜드인 경우 요청에 실패한다.

#### 브랜드 삭제

**사용자 유형**: 관리자

**적용 규칙**: `BRD-01`

**기능 정의**

- 브랜드를 삭제한다.

**기본 흐름**

1. 브랜드 존재 여부를 확인한다.
2. 해당 브랜드에 속한 상품의 좋아요를 전부 삭제한다.
3. 해당 브랜드에 속한 상품을 전부 삭제한다.
4. 브랜드를 삭제한다.

**예외 흐름**

- 존재하지 않는 브랜드인 경우 요청에 실패한다.

---

### 상품

#### 상품 목록 조회

**사용자 유형**: 일반 사용자

**기능 정의**

- 상품 목록을 조회한다.
- 최신 등록순으로 상품 목록을 정렬한다.
- 가격순(오름차순/내림차순)으로 상품 목록을 정렬한다.
- 좋아요가 많은 순으로 상품 목록을 정렬한다.
- 특정 브랜드의 상품만 필터링하여 조회한다.

**기본 흐름**

1. 상품 목록 조회를 요청한다.
2. 상품 목록을 조회한다.
3. 상품 목록을 반환한다.

**대안 흐름**

- 최신순으로 보기를 원하면 최신순으로 정렬해 보여준다.
- 가격 오름차순으로 보기를 원하면 가격 낮은 순으로 정렬해 보여준다.
- 가격 내림차순으로 보기를 원하면 가격 높은 순으로 정렬해 보여준다.
- 좋아요가 많은 순으로 보기를 원하면 좋아요가 많은 순으로 정렬해 보여준다.
- 특정 브랜드의 상품만 보기를 원하면 해당 브랜드의 상품만 필터링해 보여준다.

#### 상품 상세 조회

**사용자 유형**: 일반 사용자

**기능 정의**

- 특정 상품의 상세 정보를 조회한다.

**기본 흐름**

1. 상품 ID로 상세 조회를 요청한다.
2. 해당 상품 정보를 조회한다.
3. 상품 상세 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 상품 ID인 경우 조회에 실패한다.

#### 상품 등록

**사용자 유형**: 관리자

**적용 규칙**: `PRD-01`

**기능 정의**

- 상품 정보를 등록한다.

**기본 흐름**

1. 상품이 속할 브랜드의 존재 여부를 확인한다.
2. 상품 정보를 등록한다. (초기 재고 수량 포함)
3. 등록된 상품 정보를 반환한다.

**예외 흐름**

- 상품이 속할 브랜드가 존재하지 않는 경우 요청에 실패한다.

#### 상품 목록 조회

**사용자 유형**: 관리자

**기능 정의**

- 등록된 상품 목록을 조회한다.

**기본 흐름**

1. 상품 목록을 조회한다.
2. 상품 목록을 반환한다.

#### 상품 상세 조회

**사용자 유형**: 관리자

**기능 정의**

- 특정 상품의 상세 정보를 조회한다.

**기본 흐름**

1. 상품 ID로 상세 정보를 조회한다.
2. 상품 상세 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 상품 ID인 경우 조회에 실패한다.

#### 상품 수정

**사용자 유형**: 관리자

**기능 정의**

- 상품 정보를 수정한다.

**기본 흐름**

1. 상품 존재 여부를 확인한다.
2. 상품 정보를 수정한다. (재고 수량 포함)
3. 수정된 상품 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 상품인 경우 요청에 실패한다.

#### 상품 삭제

**사용자 유형**: 관리자

**적용 규칙**: `PRD-02`

**기능 정의**

- 상품을 삭제한다.

**기본 흐름**

1. 상품 존재 여부를 확인한다.
2. 해당 상품의 좋아요를 전부 삭제한다.
3. 상품을 삭제한다.

**예외 흐름**

- 존재하지 않는 상품인 경우 요청에 실패한다.

---

### 좋아요

#### 좋아요 등록

**사용자 유형**: 일반 사용자

**적용 규칙**: `LIK-01`

**기능 정의**

- 상품에 좋아요를 등록한다.

**기본 흐름**

1. 상품 존재 여부를 확인한다.
2. 좋아요 여부를 확인한다.
3. 좋아요를 등록한다.

**예외 흐름**

- 존재하지 않는 상품인 경우 요청에 실패한다.
- 이미 좋아요한 상품인 경우 요청에 실패한다.

#### 좋아요 취소

**사용자 유형**: 일반 사용자

**적용 규칙**: `LIK-02`

**기능 정의**

- 상품의 좋아요를 취소한다.

**기본 흐름**

1. 해당 상품에 대한 좋아요 여부를 확인한다.
2. 좋아요를 삭제한다.

**예외 흐름**

- 좋아요하지 않은 상품인 경우 요청에 실패한다.
- 본인의 좋아요가 아닌 경우 요청에 실패한다.

#### 좋아요한 상품 목록 조회

**사용자 유형**: 일반 사용자

**기능 정의**

- 자신이 좋아요한 상품 목록을 조회한다.

**기본 흐름**

1. 본인이 좋아요한 상품 목록을 조회한다.
2. 상품 목록을 반환한다.

---

### 주문

#### 주문 생성

**사용자 유형**: 일반 사용자

**적용 규칙**: `ORD-01`, `ORD-02`

**기능 정의**

- 복수 상품을 주문한다.

**기본 흐름**

1. 전체 주문 상품의 존재 여부를 확인한다.
2. 주문 시점의 상품 정보(상품명, 단가)를 스냅샷으로 수집한다.
3. 주문 상품마다 재고를 검증한다.
4. 재고를 차감한다.
   - 하나라도 재고가 부족하면 전체 롤백한다. (All or Nothing)
5. 주문을 생성한다.
6. 주문 완료 응답을 반환한다.

**예외 흐름**

- 존재하지 않는 상품이 포함된 경우 주문 전체가 실패한다.
- 하나라도 재고가 부족한 상품이 있으면 주문 전체가 실패한다. (All or Nothing)

#### 주문 취소

**사용자 유형**: 일반 사용자

**적용 규칙**: `ORD-03`, `ORD-04`

**기능 정의**

- 완료된 주문을 취소한다.

**기본 흐름**

1. 주문을 조회한다.
2. 본인 주문 여부를 확인한다.
3. 주문 상태를 확인한다.
4. 주문을 취소한다.
5. 주문 상품별 재고를 복원한다.

**예외 흐름**

- 존재하지 않는 주문인 경우 요청에 실패한다.
- 본인의 주문이 아닌 경우 요청에 실패한다.
- 이미 취소된 주문인 경우 요청에 실패한다.

#### 주문 목록 조회

**사용자 유형**: 일반 사용자

**기능 정의**

- 본인의 주문 내역을 조회한다.
- 기간별(주문일 기준)로 주문 내역을 조회한다.

**기본 흐름**

1. 본인의 주문 목록을 조회한다.
2. 주문 목록을 페이징하여 반환한다.

**대안 흐름**

- 기간별 조회를 원하면 주문일 기준으로 필터링해 보여준다.

#### 주문 상세 조회

**사용자 유형**: 일반 사용자

**기능 정의**

- 주문 상세 정보를 조회한다.

**기본 흐름**

1. 본인 주문 여부를 확인한다.
2. 주문 ID로 상세 정보를 조회한다.
3. 주문 상세 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 주문 ID인 경우 조회에 실패한다.
- 본인의 주문이 아닌 경우 조회에 실패한다.

#### 주문 목록 조회

**사용자 유형**: 관리자

**기능 정의**

- 전체 사용자의 주문 목록을 조회한다.

**기본 흐름**

1. 전체 주문 목록을 조회한다.
2. 주문 목록을 반환한다.

#### 주문 상세 조회

**사용자 유형**: 관리자

**기능 정의**

- 주문 상세 정보를 조회한다.

**기본 흐름**

1. 주문 ID로 상세 정보를 조회한다.
2. 주문 상세 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 주문 ID인 경우 조회에 실패한다.
