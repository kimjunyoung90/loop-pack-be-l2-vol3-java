# 이커머스 요구사항 정의

사용자 시나리오를 기반으로 바운디드 컨텍스트 식별, 유비쿼터스 언어 정의, 비즈니스 정책, 유스케이스를 정리한 문서

## 목차

- [1. 바운디드 컨텍스트](#1-바운디드-컨텍스트)
- [2. 유비쿼터스 언어 정의 (Glossary)](#2-유비쿼터스-언어-정의-glossary)
- [3. 비즈니스 정책 및 규칙](#3-비즈니스-정책-및-규칙)
- [4. 유스케이스](#4-유스케이스)
  - [사용자](#사용자)
  - [브랜드](#브랜드)
  - [상품](#상품)
  - [좋아요](#좋아요)
  - [주문](#주문)

---

## 1. 바운디드 컨텍스트

| 컨텍스트 | 이벤트 |
|----------|--------|
| 브랜드 | 브랜드가 등록됨, 수정됨, 삭제됨 |
| 상품 | 상품이 등록됨, 수정됨, 삭제됨, 브랜드 상품이 삭제됨 |
| 좋아요 | 상품이 좋아요됨, 좋아요 취소됨 |
| 주문 | 주문됨, 주문 취소됨 |

---

## 2. 유비쿼터스 언어 정의 (Glossary)

[glossary.md](glossary.md) 참조

---

## 3. 비즈니스 정책 및 규칙

도메인별로 지켜야 하는 비즈니스 규칙과 정책을 정의한다.
각 규칙은 고유 ID를 가지며, 기능 요구사항에서 해당 ID로 참조한다.

### 공통 정책

#### 인증 정책
- 로그인이 필요한 기능은 사용자 인증이 필요하다.

#### 인가 정책
- 관리자 기능은 관리자만 접근할 수 있다.
  - `X-Loopers-Ldap` : loopers.admin
- 관리자 외의 일반 사용자는 자신의 정보에만 접근할 수 있다.

#### 보안 정책
- 사용자의 민감한 정보는 안전하게 보호되어야 한다.

### 인증
- 인증 정보는 HTTP Header로 전달한다.
- X-Loopers-LoginId 헤더에 로그인 ID를 전달한다.
- X-Loopers-LoginPw 헤더에 로그인 Password를 전달한다.
- users 테이블에서 일치 여부를 검증한다.

### 인가
- 관리자 식별은 X-Loopers-Ldap 헤더를 통해 수행한다.
- X-Loopers-Ldap 값이 loopers.admin 인 경우 관리자로 판단한다.
- 관리자 권한이 없는 사용자가 관리자 기능에 접근하면 요청을 거부한다.

### 보안
- 비밀번호는 암호화해서 저장한다. 

### 사용자
| ID     | 규칙                                            |
|--------|-----------------------------------------------|
| USR-01 | 로그인 ID는 중복될 수 없다.                             |
| USR-02 | 로그인 ID는 비어있을 수 없다.                            |
| USR-03 | 비밀번호는 비어있을 수 없다.                              |
| USR-04 | 이름은 비어있을 수 없다.                                |
| USR-05 | 생년월일은 비어있을 수 없다.                              |
| USR-06 | 이메일은 비어있을 수 없다.                               |
| USR-07 | 비밀번호는 최소 8자 이상 16자 이하이며, 영문/숫자/특수문자를 조합해야 한다. |
| USR-08 | 사용자 비밀번호는 저장 시 해시 알고리즘으로 암호화되어야 한다.           |
| USR-09 | 비밀번호는 복호화 가능한 방식으로 저장하지 않는다.                  |
| USR-10 | 비밀번호 변경 시 동일 비밀번호로 변경할 수 없다.                  |

### 브랜드

| ID | 규칙 |
|----|------|
| BRD-01 | 브랜드 삭제 시 해당 브랜드에 속한 상품도 함께 삭제된다. |
| BRD-02 | 브랜드명은 비어있을 수 없다. |

### 상품

| ID | 규칙 |
|----|------|
| PRD-01 | 상품 등록 시 해당 상품이 속할 브랜드가 사전에 등록되어 있어야 한다. |
| PRD-02 | 상품 삭제 시 해당 상품의 좋아요도 함께 삭제된다. |
| PRD-03 | 상품명은 비어있을 수 없다. |
| PRD-04 | 상품 가격은 0보다 커야 한다. |
| PRD-05 | 상품 재고는 0 미만일 수 없다. |

### 좋아요

| ID | 규칙                         |
|----|----------------------------|
| LIK-01 | 하나의 상품에 하나의 좋아요만 가능하다. |
| LIK-02 | 본인의 좋아요만 취소할 수 있다.         |

### 주문

| ID | 규칙 |
|----|------|
| ORD-01 | 주문 시 하나라도 재고가 부족한 상품이 있으면 주문 전체가 실패한다. (All or Nothing) |
| ORD-02 | 주문 생성 시 주문 시점의 상품 정보(상품명, 단가)를 스냅샷으로 저장한다. |
| ORD-03 | 주문 취소 시 차감된 재고가 복원된다. |
| ORD-04 | 이미 취소된 주문은 재취소할 수 없다. |
| ORD-05 | 주문 수량은 1 이상이어야 한다. |
| ORD-06 | 주문에는 최소 1개 이상의 주문 항목이 포함되어야 한다. |

---

## 4. 유스케이스

### 사용자

#### 회원가입

**사용자 유형**: 비회원

**적용 규칙**: `USR-01`, `USR-02`, `USR-03`, `USR-04`, `USR-05`, `USR-06`, `USR-07`, `USR-08`, `USR-09`

**기능 정의**

- 새로운 사용자를 등록한다.

**기본 흐름**

1. 회원가입 정보를 입력한다. (로그인 ID, 비밀번호, 이름, 생년월일, 이메일)
2. 로그인 ID 중복 여부를 확인한다.
3. 비밀번호를 암호화한다.
4. 사용자 정보를 저장한다.
5. 등록된 사용자 정보를 반환한다.

**예외 흐름**

- 로그인 ID가 중복된 경우 요청에 실패한다.
- 필수 입력값이 비어있는 경우 요청에 실패한다.
- 비밀번호가 조합 규칙에 맞지 않는 경우 요청에 실패한다.

#### 내 정보 조회

**사용자 유형**: 일반 사용자

**기능 정의**

- 본인의 사용자 정보를 조회한다.

**기본 흐름**

1. 본인의 사용자 정보를 조회한다.
2. 사용자 정보를 반환한다.

#### 비밀번호 변경

**사용자 유형**: 일반 사용자

**적용 규칙**: `USR-03`, `USR-07`, `USR-08`, `USR-09`, `USR-10`

**기능 정의**

- 본인의 비밀번호를 변경한다.

**기본 흐름**

1. 현재 비밀번호를 확인한다.
2. 새 비밀번호가 기존 비밀번호와 동일하지 않은지 확인한다.
3. 새 비밀번호를 암호화한다.
4. 비밀번호를 변경한다.

**예외 흐름**

- 현재 비밀번호가 일치하지 않는 경우 요청에 실패한다.
- 새 비밀번호가 기존 비밀번호와 동일한 경우 요청에 실패한다.
- 새 비밀번호가 조합 규칙에 맞지 않는 경우 요청에 실패한다.

---

### 브랜드

#### 브랜드 목록 조회

**사용자 유형**: 일반 사용자

**기능 정의**

- 브랜드 목록을 조회한다.
- 최신 등록순으로 브랜드 목록을 정렬한다.

**기본 흐름**

1. 브랜드 목록 조회를 요청한다.
2. 브랜드 목록을 조회한다.
3. 브랜드 목록을 반환한다.

**대안 흐름**

- 최신순으로 보기를 원하면 최신순으로 정렬해 보여준다.

#### 브랜드 상세 조회

**사용자 유형**: 일반 사용자

**기능 정의**

- 특정 브랜드의 상세 정보를 조회한다.

**기본 흐름**

1. 브랜드 ID로 상세 조회를 요청한다.
2. 해당 브랜드 정보를 조회한다.
3. 브랜드 상세 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 브랜드 ID인 경우 조회에 실패한다.

#### 브랜드 등록

**사용자 유형**: 관리자

**적용 규칙**: `BRD-02`

**기능 정의**

- 브랜드 정보를 등록한다.

**기본 흐름**

1. 브랜드 정보를 등록한다.
2. 등록된 브랜드 정보를 반환한다.

#### 브랜드 목록 조회

**사용자 유형**: 관리자

**기능 정의**

- 등록된 브랜드 목록을 조회한다.

**기본 흐름**

1. 브랜드 목록을 조회한다.
2. 브랜드 목록을 반환한다.

#### 브랜드 상세 조회

**사용자 유형**: 관리자

**기능 정의**

- 특정 브랜드의 상세 정보를 조회한다.

**기본 흐름**

1. 브랜드 ID로 상세 정보를 조회한다.
2. 브랜드 상세 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 브랜드 ID인 경우 조회에 실패한다.

#### 브랜드 수정

**사용자 유형**: 관리자

**적용 규칙**: `BRD-02`

**기능 정의**

- 브랜드 정보를 수정한다.

**기본 흐름**

1. 브랜드 존재 여부를 확인한다.
2. 브랜드 정보를 수정한다.
3. 수정된 브랜드 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 브랜드인 경우 요청에 실패한다.

#### 브랜드 삭제

**사용자 유형**: 관리자

**적용 규칙**: `BRD-01`, `PRD-02`

**기능 정의**

- 브랜드를 삭제한다.

**기본 흐름**

1. 브랜드 존재 여부를 확인한다.
2. 해당 브랜드에 속한 상품의 좋아요를 전부 삭제한다.
3. 해당 브랜드에 속한 상품을 전부 삭제한다.
4. 브랜드를 삭제한다.

**예외 흐름**

- 존재하지 않는 브랜드인 경우 요청에 실패한다.

---

### 상품

#### 상품 목록 조회

**사용자 유형**: 일반 사용자

**기능 정의**

- 상품 목록을 조회한다.
- 최신 등록순으로 상품 목록을 정렬한다.
- 가격순(오름차순/내림차순)으로 상품 목록을 정렬한다.
- 좋아요가 많은 순으로 상품 목록을 정렬한다.
- 특정 브랜드의 상품만 필터링하여 조회한다.

**기본 흐름**

1. 상품 목록 조회를 요청한다.
2. 상품 목록을 조회한다.
3. 상품 목록을 반환한다.

**대안 흐름**

- 최신순으로 보기를 원하면 최신순으로 정렬해 보여준다.
- 가격 오름차순으로 보기를 원하면 가격 낮은 순으로 정렬해 보여준다.
- 가격 내림차순으로 보기를 원하면 가격 높은 순으로 정렬해 보여준다.
- 좋아요가 많은 순으로 보기를 원하면 좋아요가 많은 순으로 정렬해 보여준다.
- 특정 브랜드의 상품만 보기를 원하면 해당 브랜드의 상품만 필터링해 보여준다.

#### 상품 상세 조회

**사용자 유형**: 일반 사용자

**기능 정의**

- 특정 상품의 상세 정보를 조회한다.

**기본 흐름**

1. 상품 ID로 상세 조회를 요청한다.
2. 해당 상품 정보를 조회한다.
3. 상품 상세 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 상품 ID인 경우 조회에 실패한다.

#### 상품 등록

**사용자 유형**: 관리자

**적용 규칙**: `PRD-01`, `PRD-03`, `PRD-04`, `PRD-05`

**기능 정의**

- 상품 정보를 등록한다.

**기본 흐름**

1. 상품이 속할 브랜드의 존재 여부를 확인한다.
2. 상품 정보를 등록한다. (초기 재고 수량 포함)
3. 등록된 상품 정보를 반환한다.

**예외 흐름**

- 상품이 속할 브랜드가 존재하지 않는 경우 요청에 실패한다.

#### 상품 목록 조회

**사용자 유형**: 관리자

**기능 정의**

- 등록된 상품 목록을 조회한다.

**기본 흐름**

1. 상품 목록을 조회한다.
2. 상품 목록을 반환한다.

#### 상품 상세 조회

**사용자 유형**: 관리자

**기능 정의**

- 특정 상품의 상세 정보를 조회한다.

**기본 흐름**

1. 상품 ID로 상세 정보를 조회한다.
2. 상품 상세 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 상품 ID인 경우 조회에 실패한다.

#### 상품 수정

**사용자 유형**: 관리자

**적용 규칙**: `PRD-03`, `PRD-04`, `PRD-05`

**기능 정의**

- 상품 정보를 수정한다.

**기본 흐름**

1. 상품 존재 여부를 확인한다.
2. 상품 정보를 수정한다. (재고 수량 포함)
3. 수정된 상품 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 상품인 경우 요청에 실패한다.

#### 상품 삭제

**사용자 유형**: 관리자

**적용 규칙**: `PRD-02`

**기능 정의**

- 상품을 삭제한다.

**기본 흐름**

1. 상품 존재 여부를 확인한다.
2. 해당 상품의 좋아요를 전부 삭제한다.
3. 상품을 삭제한다.

**예외 흐름**

- 존재하지 않는 상품인 경우 요청에 실패한다.

---

### 좋아요

#### 좋아요 등록

**사용자 유형**: 일반 사용자

**적용 규칙**: `LIK-01`

**기능 정의**

- 상품에 좋아요를 등록한다.

**기본 흐름**

1. 상품 존재 여부를 확인한다.
2. 좋아요 여부를 확인한다.
3. 좋아요를 등록한다.

**예외 흐름**

- 존재하지 않는 상품인 경우 요청에 실패한다.
- 이미 좋아요한 상품인 경우 요청에 실패한다.

#### 좋아요 취소

**사용자 유형**: 일반 사용자

**적용 규칙**: `LIK-02`

**기능 정의**

- 상품의 좋아요를 취소한다.

**기본 흐름**

1. 해당 상품에 대한 좋아요 여부를 확인한다.
2. 좋아요를 삭제한다.

**예외 흐름**

- 좋아요하지 않은 상품인 경우 요청에 실패한다.
- 본인의 좋아요가 아닌 경우 요청에 실패한다.

#### 좋아요한 상품 목록 조회

**사용자 유형**: 일반 사용자

**기능 정의**

- 좋아요한 상품 목록을 조회한다.

**기본 흐름**

1. 본인이 좋아요한 상품 목록을 조회한다.
2. 상품 목록을 반환한다.

---

### 주문

#### 주문 생성

**사용자 유형**: 일반 사용자

**적용 규칙**: `ORD-01`, `ORD-02`, `ORD-05`, `ORD-06`

**기능 정의**

- 복수 상품을 주문한다.

**기본 흐름**

1. 전체 주문 상품의 존재 여부를 확인한다.
2. 주문 시점의 상품 정보(상품명, 단가)를 스냅샷으로 수집한다.
3. 주문 상품마다 재고를 검증한다.
4. 재고를 차감한다.
   - 하나라도 재고가 부족하면 전체 롤백한다. (All or Nothing)
5. 주문을 생성한다.
6. 주문 완료 응답을 반환한다.

**예외 흐름**

- 존재하지 않는 상품이 포함된 경우 주문 전체가 실패한다.
- 하나라도 재고가 부족한 상품이 있으면 주문 전체가 실패한다. (All or Nothing)

#### 주문 취소

**사용자 유형**: 일반 사용자

**적용 규칙**: `ORD-03`, `ORD-04`

**기능 정의**

- 완료된 주문을 취소한다.

**기본 흐름**

1. 주문을 조회한다.
2. 본인 주문 여부를 확인한다.
3. 주문 상태를 확인한다.
4. 주문을 취소한다.
5. 주문 상품별 재고를 복원한다.

**예외 흐름**

- 존재하지 않는 주문인 경우 요청에 실패한다.
- 본인의 주문이 아닌 경우 요청에 실패한다.
- 이미 취소된 주문인 경우 요청에 실패한다.

#### 주문 목록 조회

**사용자 유형**: 일반 사용자

**기능 정의**

- 본인의 주문 내역을 조회한다.
- 기간별(주문일 기준)로 주문 내역을 조회한다.

**기본 흐름**

1. 본인의 주문 목록을 조회한다.
2. 주문 목록을 페이징하여 반환한다.

**대안 흐름**

- 기간별 조회를 원하면 주문일 기준으로 필터링해 보여준다.

#### 주문 상세 조회

**사용자 유형**: 일반 사용자

**기능 정의**

- 주문 상세 정보를 조회한다.

**기본 흐름**

1. 본인 주문 여부를 확인한다.
2. 주문 ID로 상세 정보를 조회한다.
3. 주문 상세 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 주문 ID인 경우 조회에 실패한다.
- 본인의 주문이 아닌 경우 조회에 실패한다.

#### 주문 목록 조회

**사용자 유형**: 관리자

**기능 정의**

- 전체 사용자의 주문 목록을 조회한다.

**기본 흐름**

1. 전체 주문 목록을 조회한다.
2. 주문 목록을 반환한다.

#### 주문 상세 조회

**사용자 유형**: 관리자

**기능 정의**

- 주문 상세 정보를 조회한다.

**기본 흐름**

1. 주문 ID로 상세 정보를 조회한다.
2. 주문 상세 정보를 반환한다.

**예외 흐름**

- 존재하지 않는 주문 ID인 경우 조회에 실패한다.
