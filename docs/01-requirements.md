# 사용자 시나리오 기반 기능 정의

## 일반 사용자

### 브랜드
#### 브랜드 목록 조회
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 사용자는 브랜드 정보를 조회할 수 있다.
- 사용자는 최신 등록된 브랜드 순으로 브랜드 목록을 정렬할 수 있다.
- 사용자는 '좋아요'가 많은 순으로 브랜드 목록을 정렬할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 브랜드 목록 조회를 요청한다.
- 브랜드 목록을 조회한다.
- 브랜드 목록 조회한 값을 반환한다.

**대안 흐름**
- 사용자가 브랜드 목록을 최신순으로 보기를 원하면 최신순으로 정렬해 보여준다.
- 사용자가 브랜드 목록을 '좋아요'가 많은 순으로 보기를 원하면 '좋아요'가 많은 순으로 정렬해 보여준다.

**예외 흐름**
- 없음

#### 브랜드 정보 상세 조회
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 사용자는 특정 브랜드 정보를 조회할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 브랜드 ID로 상세 조회를 요청한다.
- 해당 브랜드 정보를 조회한다.
- 브랜드 상세 정보를 반환한다.

**대안 흐름**
- 없음

**예외 흐름**
- 존재하지 않는 브랜드 ID인 경우 조회에 실패한다.

### 상품
#### 상품 목록 조회
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 사용자는 상품 목록을 조회할 수 있다.
- 사용자는 최신 등록된 상품순으로 상품 목록을 조회할 수 있다.
- 사용자는 가격 순(오름차순/내림차순 선택 가능)으로 상품 목록을 조회할 수 있다.
- 사용자는 '좋아요'가 많은 순으로 상품 목록을 조회할 수 있다.
- 사용자는 특정 브랜드의 상품 목록을 조회할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 상품 목록 조회를 요청한다.
- 상품 목록을 조회한다.
- 상품 목록 조회한 값을 반환한다.

**대안 흐름**
- 사용자가 최신순으로 보기를 원하면 최신순으로 정렬해 보여준다.
- 사용자가 가격 오름차순으로 보기를 원하면 가격 낮은 순으로 정렬해 보여준다.
- 사용자가 가격 내림차순으로 보기를 원하면 가격 높은 순으로 정렬해 보여준다.
- 사용자가 '좋아요'가 많은 순으로 보기를 원하면 '좋아요'가 많은 순으로 정렬해 보여준다.
- 사용자가 특정 브랜드의 상품만 보기를 원하면 해당 브랜드의 상품만 필터링해 보여준다.

**예외 흐름**
- 없음

#### 상품 정보 상세 조회
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 사용자는 특정 상품의 상세 정보를 조회할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 상품 ID로 상세 조회를 요청한다.
- 해당 상품 정보를 조회한다.
- 상품 상세 정보를 반환한다.

**대안 흐름**
- 없음

**예외 흐름**
- 존재하지 않는 상품 ID인 경우 조회에 실패한다.

### 좋아요
#### 좋아요 등록
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 사용자는 특정 상품에 대해 '좋아요'를 할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 로그인 여부를 확인한다.
- 상품 존재 여부를 확인한다.
- 해당 상품에 '좋아요'를 등록한다.
- 상품의 좋아요 수를 증가시킨다. (비동기)

**대안 흐름**
- 없음

**예외 흐름**
- 로그인하지 않은 경우 요청에 실패한다.
- 존재하지 않는 상품인 경우 요청에 실패한다.
- 이미 '좋아요'한 상품인 경우 요청에 실패한다.

#### 좋아요 취소
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 사용자는 자신이 '좋아요'한 상품에 대한 '좋아요'를 취소할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 로그인 여부를 확인한다.
- 해당 상품에 대한 '좋아요' 여부를 확인한다.
- '좋아요'를 삭제한다.
- 상품의 좋아요 수를 감소시킨다. (비동기)

**대안 흐름**
- 없음

**예외 흐름**
- 로그인하지 않은 경우 요청에 실패한다.
- '좋아요'하지 않은 상품인 경우 요청에 실패한다.

#### 좋아요한 상품 목록 조회
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 사용자는 자신이 '좋아요'한 상품 목록을 조회할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 로그인 여부를 확인한다.
- 본인이 '좋아요'한 상품 목록을 조회한다.
- 상품 목록을 반환한다.

**대안 흐름**
- 없음

**예외 흐름**
- 로그인하지 않은 경우 요청에 실패한다.

### 주문
#### 주문 생성
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 사용자는 여러 상품을 한 번에 주문할 수 있다. (복수 상품 주문)
- 주문 시 하나라도 재고가 부족한 상품이 있으면 주문 전체가 실패한다.
##### 유스케이스 흐름
**기본 흐름**
- 로그인 여부를 확인한다.
- 전체 주문 상품의 존재 여부를 확인한다.
- 상품의 재고 예약 수량을 업데이트 한다.
- 하나라도 실패 시 전체 원복 한다.
- 하나라도 실패 시 전체 롤백 (All or Nothing)
- 주문을 생성한다. (주문 상태: CREATED)
- 주문 생성 시 주문 시점의 상품 정보를 가져와 저장한다. (상품명, 단가)
- 주문 상태를 변경한다. (CREATED → COMPLETED)
- 예약 재고를 원복 시키고 실제 재고를 감소시킨다. 
- 주문 완료 응답을 반환한다.

**대안 흐름**
- 없음

**예외 흐름**
- 로그인하지 않은 경우 요청에 실패한다.
- 존재하지 않는 상품이 포함된 경우 주문 전체가 실패한다.
- 하나라도 재고가 부족한 상품이 있으면 주문 전체가 실패한다. (All or Nothing)

#### 주문 취소
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 사용자는 본인의 주문을 취소할 수 있다.
- 주문 취소 시 차감된 재고가 복원된다.
##### 유스케이스 흐름
**기본 흐름**
- 로그인 여부를 확인한다.
- 본인 주문 여부를 확인한다.
- 주문 상태를 확인한다. (COMPLETED 상태만 취소 가능)
- 주문을 취소한다. (주문 상태: CANCELED)
- 주문 상품별 재고를 복원한다.

**대안 흐름**
- 없음

**예외 흐름**
- 로그인하지 않은 경우 요청에 실패한다.
- 본인의 주문이 아닌 경우 요청에 실패한다.
- 이미 취소된 주문인 경우 요청에 실패한다.

#### 주문 상태
- 생성(CREATED): 주문이 생성되고 재고가 임시 점유된 상태 (사용자에게 비노출) 
- 완료(COMPLETED): 주문이 확정되어 완료된 상태
- 취소(CANCELED): 사용자 취소 또는 타임아웃에 의해 취소된 상태, 재고 복원됨

#### 주문 타임아웃 처리 [D4]
- CREATED 상태로 일정 시간(설정값) 경과한 주문을 자동 취소한다.
- 취소 시 주문 상태를 CANCELED로 변경하고, 예약 재고 수량을 감소시켜 재고를 복원한다.
- 배치/스케줄러로 주기적으로 실행한다. (`commerce-batch` 모듈)

#### 주문 조회
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 사용자는 본인의 주문 내역을 조회할 수 있다. (COMPLETED, CANCELED만 표시)
- 사용자는 기간별(주문일 기준) 본인의 주문 내역 조회를 할 수 있다.
- 사용자는 특정 주문의 상세 정보를 조회할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 로그인 여부를 확인한다.
- 본인의 주문 목록을 조회한다. (COMPLETED, CANCELED 상태만)
- 주문 목록을 페이징하여 반환한다.

**대안 흐름**
- 사용자가 기간별 조회를 원하면 주문일 기준으로 필터링해 보여준다.
- 사용자가 특정 주문의 상세 정보를 원하면 주문 ID로 상세 조회한다.

**예외 흐름**
- 로그인하지 않은 경우 요청에 실패한다.
- 존재하지 않는 주문 ID인 경우 조회에 실패한다.
- 본인의 주문이 아닌 경우 조회에 실패한다.

---

## 관리자

### 브랜드
#### 브랜드 등록
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 관리자는 브랜드 정보를 등록할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 관리자 여부를 확인한다.
- 브랜드 정보를 등록한다.
- 등록된 브랜드 정보를 반환한다.

**대안 흐름**
- 없음

**예외 흐름**
- 관리자가 아닌 경우 요청에 실패한다.

#### 브랜드 목록 조회
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 관리자는 등록된 브랜드의 목록을 조회할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 관리자 여부를 확인한다.
- 브랜드 목록을 조회한다.
- 브랜드 목록을 반환한다.

**대안 흐름**
- 없음

**예외 흐름**
- 관리자가 아닌 경우 요청에 실패한다.

#### 브랜드 상세 조회
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 관리자는 특정 브랜드의 상세 정보를 조회할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 관리자 여부를 확인한다.
- 브랜드 ID로 상세 정보를 조회한다.
- 브랜드 상세 정보를 반환한다.

**대안 흐름**
- 없음

**예외 흐름**
- 관리자가 아닌 경우 요청에 실패한다.
- 존재하지 않는 브랜드 ID인 경우 조회에 실패한다.

#### 브랜드 수정
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 관리자는 브랜드 정보를 수정할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 관리자 여부를 확인한다.
- 브랜드 존재 여부를 확인한다.
- 브랜드 정보를 수정한다.
- 수정된 브랜드 정보를 반환한다.

**대안 흐름**
- 없음

**예외 흐름**
- 관리자가 아닌 경우 요청에 실패한다.
- 존재하지 않는 브랜드인 경우 요청에 실패한다.

#### 브랜드 삭제
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 관리자는 브랜드 정보를 삭제할 수 있다.
  - 브랜드 삭제 시 관련된 상품과 해당 상품의 좋아요도 전부 삭제되어야 한다.
##### 유스케이스 흐름
**기본 흐름**
- 관리자 여부를 확인한다.
- 브랜드 존재 여부를 확인한다.
- 해당 브랜드에 소속된 상품의 좋아요를 전부 삭제한다.
- 해당 브랜드에 소속된 상품을 전부 삭제한다.
- 브랜드를 삭제한다.

**대안 흐름**
- 없음

**예외 흐름**
- 관리자가 아닌 경우 요청에 실패한다.
- 존재하지 않는 브랜드인 경우 요청에 실패한다.

### 상품
#### 상품 등록
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 관리자는 상품 정보를 등록할 수 있다.
  - 단, 상품이 속할 브랜드가 등록되어 있어야 한다.
##### 유스케이스 흐름
**기본 흐름**
- 관리자 여부를 확인한다.
- 상품이 속할 브랜드의 존재 여부를 확인한다.
- 상품 정보를 등록한다. (초기 재고 수량 포함)
- 등록된 상품 정보를 반환한다.

**대안 흐름**
- 없음

**예외 흐름**
- 관리자가 아닌 경우 요청에 실패한다.
- 상품이 속할 브랜드가 존재하지 않는 경우 요청에 실패한다.

#### 상품 목록 조회
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 관리자는 등록된 상품 목록을 조회할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 관리자 여부를 확인한다.
- 상품 목록을 조회한다.
- 상품 목록을 반환한다.

**대안 흐름**
- 없음

**예외 흐름**
- 관리자가 아닌 경우 요청에 실패한다.

#### 상품 상세 조회
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 관리자는 상품 상세 정보를 조회할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 관리자 여부를 확인한다.
- 상품 ID로 상세 정보를 조회한다.
- 상품 상세 정보를 반환한다.

**대안 흐름**
- 없음

**예외 흐름**
- 관리자가 아닌 경우 요청에 실패한다.
- 존재하지 않는 상품 ID인 경우 조회에 실패한다.

#### 상품 수정
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 관리자는 상품 정보를 수정할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 관리자 여부를 확인한다.
- 상품 존재 여부를 확인한다.
- 상품 정보를 수정한다. (재고 수량 포함)
- 수정된 상품 정보를 반환한다.

**대안 흐름**
- 없음

**예외 흐름**
- 관리자가 아닌 경우 요청에 실패한다.
- 존재하지 않는 상품인 경우 요청에 실패한다.

#### 상품 삭제
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 관리자는 상품 정보를 삭제할 수 있다.
  - 상품 삭제 시 해당 상품의 좋아요도 전부 삭제되어야 한다.
##### 유스케이스 흐름
**기본 흐름**
- 관리자 여부를 확인한다.
- 상품 존재 여부를 확인한다.
- 해당 상품의 좋아요를 전부 삭제한다.
- 상품을 삭제한다.

**대안 흐름**
- 없음

**예외 흐름**
- 관리자가 아닌 경우 요청에 실패한다.
- 존재하지 않는 상품인 경우 요청에 실패한다.

### 주문
#### 주문 목록 조회
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 관리자는 전체 사용자의 주문 목록 조회를 할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 관리자 여부를 확인한다.
- 전체 주문 목록을 조회한다.
- 주문 목록을 반환한다.

**대안 흐름**
- 없음

**예외 흐름**
- 관리자가 아닌 경우 요청에 실패한다.

#### 주문 상세 조회
##### 사용자 시나리오 & 행위 중심의 기능 목록 정의
- 관리자는 특정 주문에 대한 상세 정보 조회를 할 수 있다.
##### 유스케이스 흐름
**기본 흐름**
- 관리자 여부를 확인한다.
- 주문 ID로 상세 정보를 조회한다.
- 주문 상세 정보를 반환한다.

**대안 흐름**
- 없음

**예외 흐름**
- 관리자가 아닌 경우 요청에 실패한다.
- 존재하지 않는 주문 ID인 경우 조회에 실패한다.
