---
name: commit-message
description:
  프로젝트의 커밋 템플릿(.gitmessage.txt)에 맞는 커밋 메시지를 작성하는 스킬.
  "커밋", "commit", "커밋 메시지", "커밋해줘" 등의 요청이 있을 때 이 스킬을 사용한다.
---

# Commit Message Skill

변경 사항을 분석하여 프로젝트의 커밋 컨벤션에 맞는 커밋 메시지를 작성하고 커밋한다.

```
Step 1. 변경 사항 분석
Step 2. 커밋 메시지 작성
Step 3. 사용자 확인 후 커밋
```

---

## 커밋 메시지 형식

`.gitmessage.txt` 템플릿을 따른다.

```
<타입>: <제목>

<본문 (선택)>

<꼬리말 (선택)>
```

### 타입 분류

| 타입 | 용도 | 예시 |
|---|---|---|
| **feat** | 새로운 기능 추가 | `feat: 주문 생성 API 구현` |
| **fix** | 버그 수정 | `fix: 재고 차감 시 음수 허용되는 문제 수정` |
| **docs** | 문서 수정 | `docs: Order API 스펙 문서 추가` |
| **style** | 코드 포맷팅 (동작 변경 없음) | `style: 불필요한 import 제거` |
| **refactor** | 코드 리팩토링 | `refactor: OrderService 주문 검증 로직 분리` |
| **test** | 테스트 코드 추가/수정 | `test: OrderService 단위 테스트 추가` |
| **chore** | 빌드, 설정, 패키지 등 | `chore: Order 도메인 의존성 추가` |

### 제목 규칙

- 50자 이내
- 마침표(.) 금지
- 한글로 작성
- "무엇을 했는지"를 간결하게 표현

### 본문 규칙 (선택)

- "무엇을", "왜" 변경했는지 위주로 작성
- "어떻게"는 코드에 나타나므로 생략
- 제목만으로 충분히 설명되면 본문 생략 가능

---

## Step 1. 변경 사항 분석

아래 명령어로 변경 사항을 확인한다.

```bash
git status
git diff --cached    # staged 변경 사항
git diff             # unstaged 변경 사항
```

### 분석 항목

- 변경된 파일 목록과 각 파일의 역할 (어떤 레이어, 어떤 도메인)
- 변경의 성격 (신규 추가 / 수정 / 삭제 / 리팩토링)
- 변경 사항 간의 논리적 그룹핑 (하나의 커밋 vs 분리 필요)

### 커밋 분리 판단 기준

하나의 커밋은 **하나의 논리적 변경 단위**를 담아야 한다.

| 상황 | 판단 |
|---|---|
| 하나의 기능 구현 (여러 레이어 걸침) | 하나의 커밋 |
| 기능 구현 + 리팩토링 | 분리 권장 → 사용자에게 확인 |
| 기능 구현 + 테스트 코드 | 하나의 커밋 가능 (함께 커밋 권장) |
| 서로 관련 없는 변경 | 분리 권장 → 사용자에게 확인 |

분리가 필요하다고 판단되면 사용자에게 제안하고 확인을 받는다.

---

## Step 2. 커밋 메시지 작성

변경 사항 분석 결과를 바탕으로 커밋 메시지를 작성한다.

### 타입 결정 우선순위

1. 새로운 파일이 추가되고 기능이 동작하면 → `feat`
2. 기존 기능의 버그가 수정되었으면 → `fix`
3. 기존 코드의 구조가 변경되었지만 동작은 동일하면 → `refactor`
4. 테스트 코드만 추가/수정되었으면 → `test`
5. 문서만 변경되었으면 → `docs`
6. 코드 포맷만 변경되었으면 → `style`
7. 빌드/설정/패키지 관련이면 → `chore`

### 메시지 작성 후 사용자에게 보여주기

```
## 커밋 메시지

타입: <타입>
제목: <제목>
본문: <본문 또는 "없음">

이 메시지로 커밋할까요?
```

---

## Step 3. 사용자 확인 후 커밋

사용자가 메시지를 확인하면 커밋을 수행한다.

### 커밋 실행

```bash
# staged 파일이 없으면 변경 파일을 stage
git add <파일들>

# 커밋 (제목만)
git commit -m "<타입>: <제목>"

# 커밋 (제목 + 본문)
git commit -m "<타입>: <제목>" -m "<본문>"
```

### HEREDOC 형식 사용 (본문이 있을 때)

```bash
git commit -m "$(cat <<'EOF'
<타입>: <제목>

<본문>
EOF
)"
```

---

## 공통 주의사항

1. 변경 사항을 읽지 않고 커밋 메시지를 작성하지 않는다.
2. 사용자 확인 없이 커밋하지 않는다.
3. `--amend`는 사용자가 명시적으로 요청한 경우에만 사용한다.
4. `.env`, 인증 정보 등 민감한 파일이 포함되어 있으면 경고한다.
5. 제목이 50자를 초과하면 줄이고, 마침표를 붙이지 않는다.
6. `git add -A`나 `git add .`를 사용하지 않고, 변경된 파일을 명시적으로 stage한다.
7. `Co-Authored-By` 줄을 커밋 메시지에 포함하지 않는다.